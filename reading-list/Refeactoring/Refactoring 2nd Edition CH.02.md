# Refactoring 2nd Edition CH.02

### TL;DR
* 리팩토링은 소프트웨어 동작은 유지한 채, 코드를 정리하는 작업을 의미한다.
* 리팩토링과 성능이 비례할 수 없지만, 리팩토링이 진행된 코드는 성능 튜닝이 쉬워진다.
* 리팩토링이 무조건 답은 아니다. 필요에 따라서 진행하고, 장기간보다는 기회가 될 때마다 진행하는 것이 더 좋다.
* 리팩토링된 코드는 파악이 쉬워지므로 기능 추가가 쉬워지고, 개발 시간을 줄일 수 있다.



### 리팩토링 정의
* 소프트웨어 동작은 유지한 채 코드를 정리하는 작업
* 작은 단위로 코드를 정리하고, 그 단계를 연결하여 큰 변화를 만들어낸다.
* 언제든 멈출 수 있다.
* 리팩토링과 성능 최적화는 코드를 변경하면서 기능을 유지한다는 점에서 공통점이 있지만, 리팩토링은 코드를 이해하고 수정하기 쉽게 만드는 작업이고, 성능 최적화는 소프트웨어의 속도에만 신경 쓴다.



### 두 개의 모자
* 기능 추가, 리팩토링의 목적을 분명히 하자
* 기능 추가 시에는 기존 코드를 건드리지 않고, 리팩토링 시에는 기능 추가를 하지 않는다.
* 모자를 빈번하게 바꿔쓰는 경우는 있어도, 동시에 두 가지 모자를 쓰지는 않아야한다.



### 리팩토링하는 이유
* 리팩토링이 무조건 정답은 아니지만, 코드의 상태를 건강하게 유지하는데 도움이 된다.
* 리팩토링하면 소프트웨어 설계가 좋아진다.
	* 중복 코드를 제거하면, 성능이 좋아지지는 않지만, 코드 파악이 쉬워지고 수정이 쉬워진다.
* 리팩토링하면 소프트웨어를 이해하기 쉬워진다.
	* 사람이 이해하기 쉬운 코드를 작성하기 위해서는 리팩토링이 필요하다.
	* 소프트웨어의 경우 유지보수도 중요하므로, 나중을 위해서라도 쉽게 파악할 수 있는 코드를 작성하자. (그게 남이 아니라 내가 될 수 있다.)
* 리팩토링하면 버그를 쉽게 찾을 수 있다.
* 리팩토링하면 프로그래밍 속도를 높일 수 있다.
	* 리팩토링이 진행되지 않으면, 초기 개발 속도는 빠를 수 있으나 기능 추가 시 코드 파악에 어려움을 겪게 되면서 결과적으로 개발 시간이 늘어난다.
	* 리팩토링이 진행된 코드의 경우, 기능 추가 시 빠르게 코드 파악이 가능하여 개발 시간을 단축 시킬 수 있다.
* 리팩토링이 잘된 코드는 초반 설계가 완벽하지 않더라도, 기존 설계를 얼마든지 쉽게 개선할 수 있다.



### 언제 리팩토링해야 할까?
* 비슷한 일은 세 번 반복하고 있다면 리팩토링이 필요한 상황이다.
* 새로운 기능을 추가하기 이전에 기능을 추가하기 쉬운 구조로 리팩토링한다.
* 코드를 파악하는 과정에서 이해하기 쉬운 구조로 리팩토링한다.
	* 간단히 수정 가능한 것은 바로 고치고, 시간이 오래 걸리는 작업이라면 하던 일을 끝내고 처리한다.
* 뛰어난 개발자는 새 기능을 추가하기 쉽도록 코드를 수정하는 것이 그 기능을 가장 빠르게 추가하는 길일 수 있음을 안다.
* 코드리뷰하는 과정에서 리뷰어와 리뷰이 간 크로스 체크를 통해 리팩토링을 진행한다.



### 리팩토링 시 고려할 문제
* 새로운 기능의 개발 속도가 저하 될 수 있다.
	* 리팩토링의 궁극적인 목표는 개발 속도를 높여서, 적은 노력으로 많은 가치를 창출하는 것이다.
	* 리팩토링은 코드를 이쁘게 꾸미는 것이 아니라, 경제적인 이유(개발 기간 단축)로 진행하는 것이다.
* 여러 사람이 같이 작업할 때는 CI 를 적용하여, 기능 통합 기간을 단축시켜야한다.
* 테스트를 통해 작은 단위로 빈번하게 리팩토링을 진행하여, 오류를 빠르게 잡는다.



### 리팩토링, 아키텍처, YAGNI
* 코딩을 시작하기 이전에 완벽한 아키텍처를 짜는 것은 거의 불가능하다.
* 변경에 대응하기 위해 유연성 메커니즘을 소프트웨어에 심어놓는 경우도 있다.
	* 하지만 이 경우에도, 다양한 케이스를 고려하다보면 함수가 복잡해지기 때문에, 오히려 역효과가 발생한다.
* 따라서, 현재까지 파악한 요구사항만 해결하는 소프트웨어를 구축하고 이후 요구사항이 추가되면, 아키텍처도 알맞게 리팩토링한다. (점진적 설계, YAGNI)



### 리팩토링과 소프트웨어 개발 프로세스
* CI 를 적용하여 팀원 각자가 수행한 리팩토링의 결과를 빠르게 팀원과 공유할 수 있다.
* 이 과정에서 YAGNI 설계 방식으로 요구사항의 변화에 빠르게 대처한다.



### 리팩토링과 성능
* 리팩토링이 잘 되어 있다면 기능 추가가 빠르게 진행되어, 성능 개선할 시간을 벌 수 있다.
* 리팩토링이 잘 되어 있는 코드는 세밀하게 분석이 가능하여 프로파일 도구를 통해 성능 개선 포인트를 빠르게 파악 가능하다.
* 단기적인 관점으로 봤을 때, 리팩토링 과정에서 성능이 느려질 수 있으나 최적화 단계에서 코드 튜닝이 쉬워지므로 결과적으로 더 빠른 소프트웨어를 얻게 된다.