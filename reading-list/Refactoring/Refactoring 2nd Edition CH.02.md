# Refactoring 2nd Edition CH.02

### TL;DR
* 리팩토링은 소프트웨어 동작은 유지한 채, 코드를 정리하는 작업을 의미한다.
* 리팩토링된 코드는 파악이 쉬워지므로 기능 추가가 쉬워지고, 개발 시간을 줄일 수 있다.
* 리팩토링과 성능이 비례할 수 없지만, 리팩토링이 진행된 코드는 성능 튜닝이 쉬워진다.
* 리팩토링이 무조건 답은 아니며, 필요에 따라서 진행하고, 장기간보다는 기회가 될 때마다 진행하는 것이 더 좋다.



### 리팩토링 정의
리팩토링이란 소프트웨어의 동작은 유지한채 중복 제거 등의 코드를 정리하는 작업을 의미한다. 이 과정에서 작은 단위로 코드를 정리하는 것이 좋으며, 그 단계들을 연결하여 변화를 만들어낸다. 작은 단위로 작업을 진행하기 때문에, 언제든 멈출 수 있는 상태가 된다.

코드를 수정하는 작업에는 크게 리팩토링과 성능 최적화 작업이 있다. 두 작업의 공통점은 기능을 유지하면서 코드를 수정하는 것이지만, 리팩토링은 코드를 이해하기 쉬운 상태로 만들어 결과적으로 수정이 쉬운 코드를 만드는 데 목적을 두고 있고, 성능 최적화는 소프트웨어의 속도를 빠르게 하는 것에만 목적을 두고 있다.
 
### 두 개의 모자, 기능 추가와 리팩토링
개발을 진행함에 있어서 기능 추가, 리팩토링의 목적을 분명히 하는 것이 좋다. 즉, 기능 추가 시에는 기존 코드를 건드리지 않고, 리팩토링 시에는 기능 추가를 하지 않는 원칙을 지켜야 한다. 개발 과정에서 모자를 빈번하게 바꿔쓰는 경우는 있어도, 동시에 두 가지 모자를 쓰지 않아야한다.

### 리팩토링하는 이유
리팩토링이 모든 경우에 정답은 아니지만, 적어도 코드의 상태를 건강하게 유지하는데 도움을 준다. 리팩토링에는 몇 가지 장점이 있다.

* 리팩토링하면 소프트웨어 설계가 좋아진다.
	* 중복 코드를 제거하면, 성능이 좋아지지는 않지만, 코드 파악이 쉬워지고 수정이 쉬워진다.
* 리팩토링하면 소프트웨어를 이해하기 쉬워진다.
	* 사람이 이해하기 쉬운 코드를 작성하기 위해서는 리팩토링이 필요하다.
	* 소프트웨어의 경우 유지보수도 중요하므로, 나중을 위해서라도 쉽게 파악할 수 있는 코드를 작성하자. (그게 남이 아니라 내가 될 수 있다.)
* 리팩토링하면 버그를 쉽게 찾을 수 있다.
* 리팩토링하면 프로그래밍 속도를 높일 수 있다.
	* 리팩토링이 진행되지 않으면, 초기 개발 속도는 빠를 수 있으나 기능 추가 시 코드 파악에 어려움을 겪게 되면서 결과적으로 개발 시간이 늘어난다.
	* 리팩토링이 진행된 코드의 경우, 기능 추가 시 빠르게 코드 파악이 가능하여 개발 시간을 단축 시킬 수 있다.
* 리팩토링이 잘된 코드는 초반 설계가 완벽하지 않더라도, 기존 설계를 얼마든지 쉽게 개선할 수 있다.

결국 리팩토링하는 이유는 기능 추가와 유지 보수 관점에서 많은 장점을 가지고 있기 때문이다.

### 언제 리팩토링해야 할까?
비슷한 일을 세 번 반복하고 있다면 리팩토링이 필요한 상황이다. 책에서 말하는 좀 더 구체적인 방법은 다음과 같다.

* 새로운 기능을 추가하기 이전에 기능을 추가하기 쉬운 구조로 리팩토링한다.
* 코드를 파악하는 과정에서 이해하기 쉬운 구조로 리팩토링한다.
* 코드리뷰하는 과정에서 리뷰어와 리뷰이 간 크로스 체크를 통해 리팩토링을 진행한다.

*뛰어난 개발자는 새 기능을 추가하기 쉽도록 코드를 수정하는 것이 그 기능을 가장 빠르게 추가하는 길일 수 있음을 안다.*

### 리팩토링 시 고려할 문제
리팩토링이 모든 문제의 해결책은 아니다. 그 과정에서 성능 저하, 개발 속도 저하 등의 문제가 발생할 수 있다. 하지만 결과적으로 봤을 때, 소스의 구조 파악이 쉬워지기 때문에 성능 튜닝이 용이해지고, 새로운 기능을 빠르게 추가할 수 있게된다.

팀원들이 같이 작업을 진행하는 경우에는, 지속적 통합이 이루어지지 않는다면, 소스가 꼬여 이를 해결하는데에 더 많은 시간이 걸릴 수 있다. 이를 해결하기 위해 CI를 도입하여 기민하게 대응하는 것이 좋다.

만약, 테스팅이 빈번하게 이루어지지 않는다면 리팩토링 과정에서 생긴 오류를 잡는데에 시간이 오래걸릴 수 있다. 따라서 작은 단위로 리팩토링을 진행하고, 테스트를 통해 어느 부분에서 오류가 발생했는지 빠르게 파악하는 것이 중요하다.

### 리팩토링, 아키텍처, YAGNI
코딩하는데에 있어, 완벽한 아키텍쳐를 구성하고 시작하는 것이 이상적이다. 하지만 요구사항의 변경 등의 이슈로 이를 실현하는 것은 거의 불가능에 가깝다. 변경에 빠르게 대응하기 위해 유연성 메커니즘을 소프트웨어에 심는 경우도 있지만, 다양한 케이스를 고려하다보면 함수의 매개변수가 많아지고, 그 내부 로직 또한 복잡해질 가능성이 높아진다. 따라서 파악된 요구사항만 해결하는 소프트웨어를 구축하고, 이후에 추가되는 요구사항에 대해 점진적으로 대응할 수 있는 구조를 가져가는 것이 중요하다. 이를 점진적 설계, YAGNI 라고 한다.

### 리팩토링과 소프트웨어 개발 프로세스
CI 를 적용하여 팀원 각자가 수행한 리팩토링의 결과를 빠르게 팀원과 공유하는 것이 좋다. 이 과정에서 YAGNI 설계 방식으로 요구사항의 변화에 빠르게 대처하면서 개발을 진행한다면, 건강한 코드를 유지한 채 개발을 진행할 수 있다.

### 리팩토링과 성능
리팩토링 과정에서 성능이 저하될 가능성이 있다. 하지만 리팩토링이 잘 되어 있다면 기능 추가가 빠르게 진행되어, 성능 개선할 시간을 벌 수 있다. 또한 구조가 깔끔한 코드는 세밀하게 분석이 가능하여 프로파일링 도구를 통해 성능 개선 포인트를 빠르게 파악 가능하다.
결과적으로 단기적인 관점으로 봤을 때, 리팩토링 과정에서 성능이 느려질 수 있으나 최적화 단계에서 코드 튜닝이 쉬워지므로 결과적으로 더 빠른 소프트웨어를 얻게 된다.
